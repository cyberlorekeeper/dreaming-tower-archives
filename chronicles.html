<!doctype html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cyber Lorekeeper â€” Chronicles</title>
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="shortcut icon" href="/images/favicon.ico">
  <meta name="description" content="Recovered chronicles from the Dreaming Tower archives. Read tales from the Digital Realm and flip to real-world analysis." />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&family=Source+Sans+3:wght@400;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="/css/styles.css" />
</head>

<body class="bg-deep-space text-stardust font-body selection:bg-glow/20 selection:text-stardust">
  <main class="relative min-h-screen">
    <!-- Background -->
    <img src="/images/background-1.png" alt="" class="absolute inset-0 h-full w-full object-cover" />
    <!-- Make overlay ignore pointer events so it doesn't interfere with hover/click -->
    <div class="absolute inset-0 pointer-events-none bg-gradient-to-br from-deep-space/70 via-abyss/80 to-deep-space/85"></div>

    <!-- Header partial -->
    <div id="site-header"></div>

    <!-- Hero -->
    <section class="relative mx-auto max-w-6xl px-6 pt-10 pb-6">
      <p class="uppercase tracking-[.18em] text-stardust/70 text-xs">
        Dreaming Tower Archives
      </p>
      <h1 class="mt-2 font-display text-4xl sm:text-5xl leading-tight text-gradient">
        Chronicles
      </h1>
      <p class="mt-4 max-w-3xl text-stardust/85">
        Recovered tales from the Digital Realm, recorded by the Lorekeeper. Open a chronicle to read the story,
        then flip the page to reveal its real-world meaning.
      </p>

      <!-- Utility row -->
      <div class="mt-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
        <div class="flex flex-wrap gap-2 text-xs text-stardust/80">
          <span class="rounded-full border border-rift/60 bg-abyss/30 px-3 py-1">Flip-to-Analysis</span>
          <span class="rounded-full border border-rift/60 bg-abyss/30 px-3 py-1">Lore + Lessons</span>
          <span class="rounded-full border border-rift/60 bg-abyss/30 px-3 py-1">New entries incoming</span>
        </div>

        <!-- Placeholder filters (Phase 2) -->
        <div class="text-sm text-stardust/70">
          <span class="inline-flex items-center gap-2 rounded-lg border border-rift/60 bg-abyss/30 px-3 py-2">
            Filters (coming soon)
          </span>
        </div>
      </div>
    </section>

    <!-- Divider -->
    <div class="relative mx-auto max-w-6xl px-6">
      <div class="h-px w-full bg-rift/60"></div>
    </div>

    <!-- Content -->
    <section class="relative mx-auto max-w-6xl px-6 pt-8 pb-10">
      <!-- OPTION 1: Make the main content appear first in the DOM, sidebar second.
           Desktop becomes 2 columns, mobile becomes 1 column with sidebar under. -->
      <div class="grid gap-6 lg:grid-cols-[1fr_340px] lg:items-start">

        <!-- Main column: Featured + List -->
        <div class="flex flex-col gap-6">
          <!-- Featured Chronicle -->
          <article id="featuredChronicle" class="soft-card p-6 hidden overflow-hidden"></article>

          <!-- Chronicle List -->
          <section id="allChronicles" class="soft-card p-6">
            <div class="flex flex-col gap-1">
              <h3 class="font-display text-xl text-stardust/95">All Chronicles</h3>
              <p class="text-sm text-stardust/75">Browse recovered entries from the Towerâ€™s archives.</p>
            </div>

            <ul id="chronicleList" class="mt-5 space-y-4"></ul>

            <p class="mt-6 text-xs text-stardust/65">
              More entries will surface as the Tower releases them.
            </p>
          </section>
        </div>

        <!-- Sidebar (now naturally comes after on mobile) -->
        <aside class="soft-card p-6 lg:mt-0">
          <h3 class="font-display text-xl text-stardust/95">Receive New Chronicles</h3>
          <p class="mt-2 text-sm text-stardust/80 leading-relaxed">
            Join the Towerâ€™s list and youâ€™ll receive a raven when new tales and excerpts are released.
          </p>

          <div class="mt-5">
            <a href="#subscribe"
               class="focus-ring inline-flex w-full items-center justify-center rounded-md bg-glow px-5 py-3 font-semibold text-abyss shadow-glow hover:brightness-110">
              Subscribe
            </a>
          </div>

          <p class="mt-3 text-xs text-stardust/65">
            No spam. Just dispatches from the Dreaming Tower when new Chronicles are released.
          </p>

          <div class="mt-6 h-px w-full bg-rift/60"></div>

          <h4 class="mt-6 font-display text-lg text-stardust/95">Coming Soon</h4>
          <ul class="mt-3 space-y-2 text-sm text-stardust/80">
            <li>â€¢ Additional recovered Chronicles</li>
            <li>â€¢ Journal excerpts from the Lorekeeper</li>
            <li>â€¢ Glitchborne field notes</li>
            <li>â€¢ World history and records</li>
          </ul>
        </aside>
      </div>
    </section>

      <!-- Email capture (Netlify Forms with JavaScript) -->
      <section id="subscribe" class="relative z-10 mt-12 mx-auto max-w-xl scroll-mt-24">  
        <div class="mt-8 mx-auto max-w-xl scroll-mt-24">
          <!-- Success Message (hidden by default) -->
          <div id="subscribe-success" class="hidden mb-4 rounded-md bg-nebula/20 border border-glow/40 px-6 py-4 text-center backdrop-blur transition-opacity duration-500">
            <p class="text-glow font-semibold">ðŸ“œ Inscription Complete</p>
            <p class="mt-1 text-sm text-stardust/85">Your name has been added to the Tower's registry.</p>
          </div>
      
          <!-- Error Message (hidden by default) -->
          <div id="subscribe-error" class="hidden mb-4 rounded-md border border-red-400/60 bg-red-400/10 px-6 py-4 text-center backdrop-blur transition-opacity duration-500">
            <p class="text-red-400 font-semibold">âš  Something went wrong</p>
            <p class="mt-1 text-sm text-stardust/85">Please try again or contact us if the problem persists.</p>
          </div>
      
          <form id="subscribe-form" name="chronicle-subscribe" method="POST" data-netlify="true" netlify-honeypot="bot-field"
            class="grid gap-3 text-left">
            <input type="hidden" name="form-name" value="chronicle-subscribe" />
        
            <!-- Honeypot -->
            <p class="hidden">
              <label>Don't fill this out: <input name="bot-field" /></label>
            </p>
            
            <!-- Name and Email Row -->
            <div class="grid gap-3 sm:grid-cols-2">
              <div>
                <label class="sr-only" for="name">First Name</label>
                <input id="name" name="name" type="text"
                  class="focus-ring w-full rounded-md border border-rift/60 bg-deep-space/60 px-4 py-3 placeholder:text-stardust/60 text-stardust"
                  placeholder="Your name (optional)"/>
              </div>
              
              <div>
                <label class="sr-only" for="email">Email</label>
                <input id="email" name="email" type="email" required
                  class="focus-ring w-full rounded-md border border-rift/60 bg-deep-space/60 px-4 py-3 placeholder:text-stardust/60 text-stardust"
                  placeholder="you@realm.co"/>
              </div>
            </div>
        
            <button type="submit" id="subscribe-button" class="focus-ring inline-flex items-center justify-center rounded-md bg-glow px-5 py-3 font-semibold text-abyss shadow-glow hover:brightness-110 disabled:opacity-50 disabled:cursor-not-allowed">
              Subscribe
            </button>
          </form>
      
          <p class="mt-3 text-center text-xs text-stardust/65">
            No spam. Just dispatches from the Dreaming Tower when new Chronicles are released.
          </p>
        </div>
      </section>
      
      <script>
        (function() {
          // Handle newsletter subscription
          const form = document.getElementById('subscribe-form');
          const successMessage = document.getElementById('subscribe-success');
          const errorMessage = document.getElementById('subscribe-error');
          const submitButton = document.getElementById('subscribe-button');
      
          if (!form) return;
      
          form.addEventListener('submit', async (e) => {
            e.preventDefault();
      
            // Get form data
            const formData = new FormData(form);
      
            // Disable button and show loading state
            submitButton.disabled = true;
            const originalButtonText = submitButton.textContent;
            submitButton.textContent = 'Subscribing...';
      
            // Hide any previous messages
            successMessage.classList.add('hidden');
            errorMessage.classList.add('hidden');
      
            try {
              // Submit to Netlify
              const response = await fetch('/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams(formData).toString()
              });
      
              if (response.ok) {
                // Show success message with fade-in
                successMessage.classList.remove('hidden');
                successMessage.style.opacity = '0';
                
                // Scroll message into view
                successMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                
                // Trigger fade-in
                setTimeout(() => {
                  successMessage.style.opacity = '1';
                }, 10);
      
                // Reset form
                form.reset();
      
                // Fade out after 5 seconds
                setTimeout(() => {
                  successMessage.style.opacity = '0';
                  setTimeout(() => {
                    successMessage.classList.add('hidden');
                  }, 500);
                }, 5000);
      
              } else {
                throw new Error('Submission failed');
              }
            } catch (error) {
              console.error('Error:', error);
              
              // Show error message
              errorMessage.classList.remove('hidden');
              errorMessage.style.opacity = '0';
              
              // Scroll message into view
              errorMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
              
              setTimeout(() => {
                errorMessage.style.opacity = '1';
              }, 10);
      
              // Hide error after 7 seconds
              setTimeout(() => {
                errorMessage.style.opacity = '0';
                setTimeout(() => {
                  errorMessage.classList.add('hidden');
                }, 500);
              }, 7000);
            } finally {
              // Reset button
              submitButton.disabled = false;
              submitButton.textContent = originalButtonText;
            }
          });
        })();
      </script>

    <!-- Footer partial (outside the content section so it can breathe) -->
    <div id="site-footer" class="relative"></div>
  </main>

  <script>
      const CHRONICLES = [
    {
      enabled: true,
      featured: false,
      type: "Recovered Chronicle",
      title: "The Breach at Merchantâ€™s Gate",
      href: "/chronicles/merchants-gate.html",
      blurb: "Seven entities entered through trusted writs and moved like ink through commerce, records, keys, and vaults. The Kingdom survived, but only by invoking a dangerous Purge Script and accepting loss.",
      tags: ["Theme: Supply Chain", "Threat: Rot Swarm", "Flip: Real-World Analysis"],
      status: "Complete",
      readTime: "~10â€“12 min"
    },
    {
      enabled: false,
      featured: false,
      type: "Recovered Chronicle",
      title: "The Choice Between Walls",
      href: "/chronicles/choice-between-walls.html",
      blurb: "When the Great Corruption threatens to cascade, Queen Lyra chooses between connectivity and collapse, and pays the price of certainty in real time.",
      tags: ["Focus: Queen Lyra", "Theme: Crisis Decision", "Flip: Real-World Analysis"],
      status: "Complete",
      readTime: "~9â€“11 min"
    },
    {
      enabled: false,
      featured: false,
      type: "Recovered Chronicle",
      title: "The Wall That Held",
      href: "/chronicles/the-wall-that-held.html",
      blurb: "High Commander Valdris demands hard defenses and decisive action when hesitation becomes its own vulnerability.",
      tags: ["Focus: Valdris", "Theme: Defense-in-Depth", "Flip: Real-World Analysis"],
      status: "Complete",
      readTime: "~8â€“10 min"
    },
    {
      enabled: false,
      featured: false,
      type: "Recovered Chronicle",
      title: "The Price of Certainty",
      href: "/chronicles/the-price-of-certainty.html",
      blurb: "Merchant-Lord Cassia weighs disruption, trust, and the cost of security decisions that ripple through every trade lane.",
      tags: ["Focus: Cassia", "Theme: Business Impact", "Flip: Real-World Analysis"],
      status: "Complete",
      readTime: "~8â€“10 min"
    }
  ];

    const featuredEl = document.getElementById('featuredChronicle');
    const allListEl = document.getElementById('chronicleList');

    const visible = CHRONICLES.filter(c => c.enabled);
    const featured = visible.find(c => c.featured);

    if (featured && featuredEl) {
      featuredEl.classList.remove('hidden');

      featuredEl.innerHTML = `
        <div class="flex flex-col gap-5">
          <div class="flex items-start gap-6">
            <div class="min-w-0">
              <p class="uppercase tracking-[.18em] text-stardust/70 text-xs">Featured â€¢ ${featured.type}</p>
              <h2 class="mt-2 font-display text-2xl sm:text-3xl text-stardust/95">${featured.title}</h2>
              <p class="mt-3 text-stardust/85 leading-relaxed">${featured.blurb}</p>

              <div class="mt-4 flex flex-wrap gap-2">
                ${(featured.tags || []).map(t => `<span class="tag">${t}</span>`).join("")}
              </div>
            </div>

            <div class="hidden sm:grid grid-cols-1 gap-3 shrink-0 sm:w-[220px]">
              <div class="meta-pill">
                <p class="text-[11px] uppercase tracking-[.18em] text-stardust/60">Status</p>
                <p class="mt-1 text-sm text-stardust/90">${featured.status || ""}</p>
              </div>
              <div class="meta-pill">
                <p class="text-[11px] uppercase tracking-[.18em] text-stardust/60">Read time</p>
                <p class="mt-1 text-sm text-stardust/90">${featured.readTime || ""}</p>
              </div>
            </div>
          </div>

          <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
            <a href="${featured.href}"
               class="focus-ring inline-flex items-center justify-center rounded-md bg-glow px-5 py-3 font-semibold text-abyss shadow-glow hover:brightness-110">
              Open Chronicle â†’
            </a>

            <a href="/characters/"
               class="inline-flex items-center justify-center rounded-md border border-rift/60 bg-deep-space/20 px-5 py-3 text-sm text-stardust/85 hover:text-glow">
              Meet the characters
            </a>
          </div>
        </div>
      `;
    }

    if (allListEl) {
      allListEl.innerHTML = visible.map(c => `
        <li class="rounded-xl border border-rift/60 bg-deep-space/10 p-5">
          <div class="flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between">
            <div class="min-w-0">
              <p class="uppercase tracking-[.18em] text-stardust/60 text-xs">${c.type}</p>
              <h4 class="mt-2 font-display text-2xl text-stardust/95">
                <a class="hover:text-glow underline underline-offset-4" href="${c.href}">
                  ${c.title}
                </a>
              </h4>
              <p class="mt-3 text-sm text-stardust/80 leading-relaxed">${c.blurb || ""}</p>

              <div class="mt-4 flex flex-wrap gap-2">
                ${(c.tags || []).map(t => `<span class="tag">${t}</span>`).join("")}
              </div>
            </div>

            <div class="flex flex-row gap-2 sm:flex-col sm:items-end">
              ${c.status ? `<span class="tag">Status: ${c.status}</span>` : ""}
              ${c.readTime ? `<span class="tag">Read: ${c.readTime}</span>` : ""}
            </div>
          </div>

          <div class="mt-5">
            <a href="${c.href}"
               class="inline-flex items-center text-sm text-stardust/80 hover:text-glow underline underline-offset-4">
              Open chronicle â†’
            </a>
          </div>
        </li>
      `).join("");
    }

    async function loadPartial(targetId, url) {
      const el = document.getElementById(targetId);
      if (!el) return;

      const res = await fetch(url, { cache: "no-cache" });
      if (!res.ok) {
        console.warn(`Failed to load ${url}`);
        return;
      }
      el.innerHTML = await res.text();
    }

    function initHeaderNav() {
      const navToggle = document.getElementById("navToggle");
      const mobileNavPanel = document.getElementById("mobileNavPanel");

      if (!navToggle || !mobileNavPanel) return;

      navToggle.addEventListener("click", () => {
        const isOpen = navToggle.getAttribute("aria-expanded") === "true";
        navToggle.setAttribute("aria-expanded", String(!isOpen));
        mobileNavPanel.classList.toggle("hidden", isOpen);
      });

      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          navToggle.setAttribute("aria-expanded", "false");
          mobileNavPanel.classList.add("hidden");
        }
      });
    }

    function initFooterYear() {
      const year = document.getElementById("year");
      if (year) year.textContent = new Date().getFullYear();
    }

    (async function boot() {
      await loadPartial("site-header", "/partials/header.html");
      initHeaderNav();

      await loadPartial("site-footer", "/partials/footer.html");
      initFooterYear();
    })();
  </script>
</body>
</html>
