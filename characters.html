<!doctype html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Character Codex | The Dreaming Tower Archives</title>

    <!-- Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&family=Source+Sans+3:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
  
    <!-- IMPORTANT: Tailwind config must load BEFORE Tailwind CDN -->
    <script src="/assets/js/tailwind-config.js?v4"></script>
    <script src="https://cdn.tailwindcss.com"></script>
  
    <!-- Global CSS (your shared component classes like soft-card, tag, etc.) -->
    <link rel="stylesheet" href="/assets/css/styles.css?v=4" />
  
    <!-- World-only CSS -->
    <link rel="stylesheet" href="/assets/css/characters.css?v3" />

  <div id="site-header"></div>
</head>

<body class="bg-deep-space text-stardust font-body selection:bg-glow/20 selection:text-stardust">
  <main class="relative min-h-screen">

     <div id="site-header"></div>

    <!-- Hero -->
    <section class="relative mx-auto max-w-6xl px-6 pt-10 pb-8">
      <p class="uppercase tracking-[.18em] text-stardust/70 text-xs">Character Codex</p>
      <h1 class="mt-2 font-display text-4xl sm:text-5xl leading-tight text-gradient">The Codex of Names</h1>
      <p class="mt-4 text-stardust/85 max-w-3xl leading-relaxed">
        Figures who shaped the Dreaming Tower, crossed the Digital Realm, and left footprints in the record.
        Some are allies. Some are warnings. All are remembered.
      </p>

      <!-- Controls -->
      <div class="mt-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
        <div class="flex flex-wrap gap-2">
          <button data-filter="all" class="filter-btn focus-ring rounded-md border border-rift/60 bg-abyss/30 px-4 py-2 text-sm font-semibold text-stardust/85 hover:text-glow" type="button">
            All
          </button>
          <button data-filter="core" class="filter-btn focus-ring rounded-md border border-rift/60 bg-abyss/30 px-4 py-2 text-sm font-semibold text-stardust/85 hover:text-glow" type="button">
            Core
          </button>
          <button data-filter="ally" class="filter-btn focus-ring rounded-md border border-rift/60 bg-abyss/30 px-4 py-2 text-sm font-semibold text-stardust/85 hover:text-glow" type="button">
            Allies
          </button>
          <button data-filter="threat" class="filter-btn focus-ring rounded-md border border-rift/60 bg-abyss/30 px-4 py-2 text-sm font-semibold text-stardust/85 hover:text-glow" type="button">
            Threats
          </button>
        </div>

        <div class="sm:w-80">
          <input id="searchInput"
                 class="focus-ring w-full rounded-md border border-rift/60 bg-abyss/30 px-4 py-2 text-sm text-stardust/90 placeholder:text-stardust/50"
                 type="search"
                 placeholder="Search characters..." />
        </div>
      </div>
    </section>

    <!-- Grid -->
    <section class="relative mx-auto max-w-6xl px-6 pb-14">
      <div id="characterGrid" class="grid gap-5 sm:grid-cols-2 lg:grid-cols-3">
        <!-- JS will render cards here -->
      </div>

    </section>
  </main>

  <div id="site-footer"></div>
  <script src="/assets/js/site.js?v=1"></script>
  
  <script>
   
    // Add characters here. Only enabled entries render.
    const CHARACTERS = [
      {
        enabled: true,
        name: "The Lorekeeper",
        href: "/characters/lorekeeper.html",
        blurb: "Custodian of the Dreaming Tower archives. Keeper of breach history, patterns, and the cost of remembering.",
        tags: ["core", "advisor", "tower-bound"]
      },
      {
        enabled: false,
        name: "Shade",
        href: "/characters/shade.html",
        blurb: "A fractured shadow with a memory of cages, vaults, and bargains that refuse to stay buried.",
        tags: ["ally"]
      },
      {
        enabled: false,
        name: "Queen Lyra",
        href: "/characters/queen-lyra.html",
        blurb: "Sovereign of the realm. A leader balancing survival, perception, and the politics of what must be forgotten.",
        tags: ["core"]
      }
    ];

    const grid = document.getElementById('characterGrid');
    const searchInput = document.getElementById('searchInput');
    const filterBtns = Array.from(document.querySelectorAll('.filter-btn'));

    let activeFilter = "all";
    let query = "";

    function render() {
      const enabled = CHARACTERS.filter(c => c.enabled);

      const filtered = enabled.filter(c => {
        const matchesFilter = (activeFilter === "all") || (c.tags || []).includes(activeFilter);
        const hay = `${c.name} ${(c.blurb || "")} ${(c.tags || []).join(" ")}`.toLowerCase();
        const matchesQuery = !query || hay.includes(query);
        return matchesFilter && matchesQuery;
      });

      if (filtered.length === 0) {
        grid.innerHTML = `
          <div class="soft-card p-6 sm:col-span-2 lg:col-span-3">
            <p class="font-display text-xl text-stardust/95">No matches</p>
            <p class="mt-2 text-sm text-stardust/75">Try a different filter or search term.</p>
          </div>
        `;
        return;
      }

      grid.innerHTML = filtered.map(c => `
        <a href="${c.href}" class="soft-card card-hover p-6 block">
          <p class="uppercase tracking-[.18em] text-stardust/60 text-xs">Codex Entry</p>
          <h2 class="mt-2 font-display text-2xl text-stardust/95">${c.name}</h2>
          <p class="mt-3 text-sm text-stardust/80 leading-relaxed">${c.blurb || ""}</p>

          <div class="mt-4 flex flex-wrap gap-2">
            ${(c.tags || []).map(t => `<span class="tag">${t}</span>`).join("")}
          </div>

          <div class="mt-5 text-sm text-stardust/80">
            <span class="underline underline-offset-4 hover:text-glow">Open entry â†’</span>
          </div>
        </a>
      `).join("");
    }

    // Filter behavior
    filterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        activeFilter = btn.getAttribute('data-filter') || "all";
        filterBtns.forEach(b => b.classList.remove('ring-2','ring-glow/40'));
        btn.classList.add('ring-2','ring-glow/40');
        render();
      });
    });

    // Default active state
    const defaultBtn = filterBtns.find(b => b.getAttribute('data-filter') === 'all');
    if (defaultBtn) defaultBtn.classList.add('ring-2','ring-glow/40');

    // Search behavior
    searchInput.addEventListener('input', (e) => {
      query = (e.target.value || "").trim().toLowerCase();
      render();
    });

    render();

    async function loadPartial(targetId, url) {
      const el = document.getElementById(targetId);
      if (!el) return;
  
      const res = await fetch(url, { cache: "no-cache" });
      if (!res.ok) {
        console.warn(`Failed to load ${url}`);
        return;
      }
      el.innerHTML = await res.text();
    }
  
    function initHeaderNav() {
      const navToggle = document.getElementById("navToggle");
      const mobileNavPanel = document.getElementById("mobileNavPanel");
  
      if (!navToggle || !mobileNavPanel) return;
  
      navToggle.addEventListener("click", () => {
        const isOpen = navToggle.getAttribute("aria-expanded") === "true";
        navToggle.setAttribute("aria-expanded", String(!isOpen));
        mobileNavPanel.classList.toggle("hidden", isOpen);
      });
  
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          navToggle.setAttribute("aria-expanded", "false");
          mobileNavPanel.classList.add("hidden");
        }
      });
    }
  
    function initFooterYear() {
      const year = document.getElementById("year");
      if (year) year.textContent = new Date().getFullYear();
    }
  
    (async function boot() {
      await loadPartial("site-header", "/partials/header.html");
      initHeaderNav();
  
      await loadPartial("site-footer", "/partials/footer.html");
      initFooterYear();
    })();
  </script>
</body>
</html>
