<!doctype html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Price of Certainty: Part 1 | DTA Chronicle</title>
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="shortcut icon" href="/images/favicon.ico">
  <meta name="description" content="Part 1: The Ledger Crisis â€” Merchant-Lord Cassia faces economic chaos when transaction systems begin corrupting themselves. The Secret Council must decide: shutdown, chaos, or a 70% gamble." />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&family=Crimson+Pro:ital,wght@0,400;0,500;0,600;1,400;1,500&family=Source+Sans+3:wght@400;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="/css/styles.css" />
</head>

<body class="bg-deep-space text-stardust font-body selection:bg-glow/20 selection:text-stardust">
  <main class="relative min-h-screen">
    <!-- Background -->
    <img src="/images/background-1.png" alt="" class="absolute inset-0 h-full w-full object-cover" />
    <div class="absolute inset-0 bg-gradient-to-br from-deep-space/70 via-abyss/80 to-deep-space/85"></div>

    <div id="site-header"></div>

    <!-- Chronicle Header -->
    <section class="relative mx-auto max-w-7xl px-6 pt-10 pb-6">
      <p class="uppercase tracking-[.18em] text-stardust/70 text-xs">
        Serialized Chronicle â€¢ Part 1 of 3
      </p>
      
      <div class="mt-2 flex flex-col gap-5">
        <div class="flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between">
          <div>
            <h1 class="font-display text-4xl sm:text-5xl leading-tight text-gradient">
              The Price of Certainty
            </h1>
            <p class="font-display text-xl text-stardust/80 mt-2">Part 1: The Ledger Crisis</p>
            <p class="mt-3 text-stardust/85 max-w-3xl">
              Transaction records are destroying themselves. Cassia has hours before merchants lose trust in the entire economic system.
            </p>
        
            <div class="mt-4 flex flex-wrap gap-2">
              <span class="part-indicator">Part 1 of 3</span>
              <span class="rounded-full border border-rift/60 bg-abyss/30 px-3 py-1 text-xs text-stardust/80">Theme: Data Integrity</span>
              <span class="rounded-full border border-rift/60 bg-abyss/30 px-3 py-1 text-xs text-stardust/80">A Cassia Chronicle</span>
            </div>
          </div>

          <div class="lg:pt-2">
            <a href="#subscribe"
               class="focus-ring inline-flex items-center justify-center rounded-md bg-glow px-5 py-3 font-semibold text-abyss shadow-glow hover:brightness-110 whitespace-nowrap">
              Subscribe
            </a>
          </div>
        </div>

        <!-- Toggle between Chronicle and Real-World Brief -->
        <div class="flex flex-col items-center text-center">
          <div class="toggle-wrap" role="group" aria-label="Chronicle view toggle">
            <button id="btnStory" class="toggle-btn focus-ring flex items-center gap-2" type="button" aria-pressed="true">
              <span class="toggle-icon" aria-hidden="true">â—‰</span>
              <span>Chronicle</span>
            </button>
            
            <button id="btnAnalysis" class="toggle-btn focus-ring flex items-center gap-2" type="button" aria-pressed="false">
              <span class="toggle-icon" aria-hidden="true">â—¯</span>
              <span>Real-World Brief</span>
            </button>
          </div>
          <p class="mt-2 text-xs text-stardust/65">
            Flip to reveal the real-world cybersecurity lesson.
          </p>
        </div>
      </div>
    </section>

    <!-- Divider -->
    <div class="relative mx-auto max-w-7xl px-6">
      <div class="h-px w-full bg-rift/60"></div>
    </div>

    <!-- Content Panels -->
    <section class="relative mx-auto w-full max-w-[1100px] px-4 sm:px-6 lg:px-8 pt-8 pb-14">

      <!-- Story Panel -->
      <article id="panelStory" class="story-panel is-active">
        <div class="mx-auto max-w-4xl prose-lore font-prose text-lg">

<p class="drop-cap">The ledger crystal shattered.</p>

<p>Not physicallyâ€”the device remained whole in Cassia Goldthread's handâ€”but the data streaming across its surface fractured into chaos. Numbers that should have aligned twisted into contradictions. Transactions that had cleared hours ago now showed as pending, disputed, or simply <em>gone</em>.</p>

<p>She sat in her private office overlooking the merchant quarter, watching the morning sun paint the Crown City in shades of gold and amber. Beautiful. Peaceful. Utterly at odds with the economic nightmare unfolding in her hands.</p>

<p>"No," she whispered. "No, no, no."</p>

<p>A soft knock. Her aide, Marcus, entered with his usual morning efficiency. "Merchant-Lord, the Guild Council isâ€”" He stopped, reading her expression. "What's wrong?"</p>

<p>"How many merchant houses have reported transaction anomalies this morning?"</p>

<p>"Seventeen, last I checked. Why?"</p>

<p>Cassia turned the crystal toward him. "It's not seventeen. It's everyone. Every single trading house in the Crown City. The data is corrupted. We can't verify anything."</p>

<p>Marcus went pale. "The authentication reset. We just finished that. Howâ€”"</p>

<p>"I don't know. But if merchants can't verify their transactions, if customers can't confirm their purchases, if we can't prove who owns what..." She didn't finish. She didn't need to.</p>

<p>The ledger crystal pulsed, and a new alert appeared. Then another. Then a dozen more.</p>

<p>Guild after guild reporting the same problem.</p>

<p>The Kingdom's economy was eating itself.</p>

<hr>

<h3>Two Hours Later â€” Emergency Guild Council Session</h3>

<p>The Guild Hall was chaos contained by marble walls and expensive architecture.</p>

<p>Forty guild leaders shouted over each other, their voices echoing off the vaulted ceiling. Master Ironworks pounded the table. Mistress Threadweaver gestured furiously at her own malfunctioning ledger crystal. Someone in the back was threatening to sue someone else over a shipment that may or may not have ever existed.</p>

<p>Cassia stood at the head of the chamber, still and silent, waiting for the fury to exhaust itself.</p>

<p>It took twenty minutes.</p>

<p>Finally, Master Kelvin of the Spice Tradersâ€”her mentor, her friend, and currently her harshest criticâ€”stood. The room quieted out of respect for his age and influence.</p>

<p>"Merchant-Lord Goldthread," he said, his voice heavy with restrained anger. "Three hours ago, my house processed a shipment of saffron from the Eastern Provinces. The transaction cleared. Payment was confirmed. Now the system says that shipment never existed. I have a warehouse full of saffron that, according to our records, <em>doesn't exist</em>. Do I pay for it? Do I not pay? How do I sell something that isn't real?"</p>

<p>Murmurs of agreement rippled through the chamber.</p>

<p>"My cloth deliveries have vanished from the records," Mistress Threadweaver said.</p>

<p>"My iron shipments never arrived, according to the system," Master Ironworks added. "Except they're sitting in my forge right now."</p>

<p>"My grain contracts have been duplicated," another merchant called. "The system thinks I delivered twice what I actually sent. Do I charge for what I delivered or what the ledger says?"</p>

<p>The room erupted again.</p>

<p>Cassia let it run for thirty seconds, then raised her hand. The room quietedâ€”not completely, but enough.</p>

<p>"I know," she said, her voice carrying over the grumbling. "I know, and I'm working on it. This appears to be a cascading failure in our transaction verification systemsâ€”"</p>

<p>"A failure you assured us was impossible after the authentication reset!" someone shouted.</p>

<p>"A failure that's going to bankrupt us while the Council debates!" another added.</p>

<p>Cassia kept her voice level. "The Secret Council is meeting in one hour. I will present the economic impact data and demand immediate action. But I need accurate information from all of you. How many houses are affected? What's the pattern?"</p>

<p>Master Kelvin stepped forward again. "All houses. All transactions in the past twelve hours. And the patternâ€”" His expression was grim. "The pattern is that there is no pattern. It's random. Chaotic. Almost like something is <em>playing</em> with us."</p>

<p>A chill ran down Cassia's spine.</p>

<p>"Playing," she repeated.</p>

<p>"My exact word. Transactions appear and disappear. Records change while you're looking at them. It's not corruption. It's <em>manipulation</em>."</p>

<p>She thought of the Merchant's Gate breach. The authentication reset. The warnings Shade had brought about secondary attacks.</p>

<p>This was the second phase.</p>

<p>"Give me two hours," she said. "The Council will have answers, or I will get them myself. In the meantimeâ€”" She made a decision that would either save them or destroy her career. "All houses revert to manual ledger operations. Paper records. Verified transactions only. Nothing digital until we know what we're dealing with."</p>

<p>The room exploded.</p>

<p>"You're joking!"</p>

<p>"That will slow everything to a crawl!"</p>

<p>"The Midwinter Summit is in three weeksâ€”we can't process that volume manually!"</p>

<p>"DO YOU HAVE A BETTER OPTION?" Cassia's voice cracked through the chaos like a whip. "Our digital systems are compromised. We can either work slowly with accuracy or quickly with garbage. Choose."</p>

<p>Silence.</p>

<p>Master Kelvin nodded slowly. "Manual records. Verified by two witnesses minimum. Triple-checked before finalization."</p>

<p>One by one, the other guild leaders agreed. Reluctantly. Furiously. But they agreed.</p>

<p>"Two hours," Cassia said. "I promise you, answers in two hours."</p>

<p>She left before they could argue further.</p>

<hr>

<h3>One Hour Later â€” Secret Council Chamber</h3>

<p>Cassia arrived early, her ledger crystal clutched in one hand and a stack of hastily compiled reports in the other. The Queen was already there, reviewing something with concern etched on her face.</p>

<p>"Your Majesty," Cassia said. "We have a crisis."</p>

<p>"I know. The Lorekeeper alerted me twenty minutes ago. Something about economic chaos matching a pattern fromâ€”"</p>

<p>"Merchant-Lord." The Lorekeeper's voice emerged from the shadows as he entered, his ancient staff clicking against stone. "The transaction corruption. When did it begin?"</p>

<p>"First reports came in at dawn. Why?"</p>

<p>"Because ninety-two years ago, a similar attack struck the Southern Kingdoms. They called it the Ledger Plague. It didn't steal wealthâ€”it made wealth impossible to verify. Within weeks, their economy collapsed. Trade stopped. Governments fell."</p>

<p>Cassia felt her stomach drop. "How did they stop it?"</p>

<p>The Lorekeeper's expression was grim. "They didn't. The kingdoms dissolved. Some territories recovered decades later. Others never did."</p>

<p>High Commander Valdris strode in, his armor already battle-ready despite the hour. "Reports from the Sentinels. We've detected an entity operating in the transaction verification systems. It's not stealing data. It's not corrupting it in any traditional sense. It's..." He struggled for words. "It's <em>playing</em> with it."</p>

<p>"Playing," Cassia echoed Master Kelvin's word. "That's the second time I've heard that description."</p>

<p>Shade materialized in his corner, Whisper shimmering with unusual agitation. "Not playing. Testing."</p>

<p>Everyone turned to him.</p>

<p>"The entity is learning," Shade continued. "Watching how we respond to chaos. Measuring our tolerance for uncertainty. This isn't an attack on the economy. It's a study. It wants to understand how much disruption we can absorb before we break."</p>

<p>"Why?" the Queen asked.</p>

<p>"Because once it knows our breaking point, it can bring us exactly to that edge. Keep us there. Bleed us slowly instead of striking fast."</p>

<p>The room fell silent.</p>

<p>Cassia was the first to speak. "We need to purge it. Now. Before it learns more."</p>

<p>"The Purge Script?" Valdris asked. "We just used that three weeks ago. The systems are still recovering."</p>

<p>"Then we use something else. The Lorekeeper must have another protocolâ€”"</p>

<p>"There isn't one," the Lorekeeper said quietly. "Not for this. The Purge Script was designed for corruption, for malicious code that can be identified and eliminated. This entity doesn't corrupt. It manipulates. It changes things in ways that are technically <em>valid</em>â€”just wrong."</p>

<p>"Then what do we do?" Cassia demanded. "Let it destroy our economy while we watch?"</p>

<p>"We could shut down all transaction systems," Valdris suggested. "Complete isolation. Manual everything untilâ€”"</p>

<p>"Manual everything for how long?" Cassia interrupted. "Weeks? Months? The Midwinter Summit brings in forty percent of our annual trade revenue. We shut down now, we lose that. Merchants who depend on that income will fold. The economic damage could be worse than the entity itself."</p>

<p>"Will survive," Valdris said flatly. "Better poor than corrupted."</p>

<p>"Easy for you to say when it's not your livelihood on the line!"</p>

<p>"ENOUGH." The Queen's voice cut through the argument. "Cassia, what's your assessment? Actual numbers."</p>

<p>Cassia took a breath, forcing herself to be clinical. "If we shut down all digital transaction systems: immediate loss of sixty percent of trade capacity. Within one week, forty-seven merchant houses will be unable to meet their obligations. Within two weeks, that number doubles. By month's end, we're looking at a depression that will take years to recover from."</p>

<p>"And if we don't shut down?" Lyra asked.</p>

<p>"The chaos spreads. Merchants stop trusting any records. Disputes escalate. Within a week, we're operating on reputation and trust aloneâ€”which works fine until someone exploits that trust. Within two weeks, same result. Economic collapse. Just with extra chaos along the way."</p>

<p>"Both options are unacceptable," the Queen said.</p>

<p>"Yes," Cassia agreed. "Welcome to my morning."</p>

<p>Shade's voice emerged from the corner. "There's a third option."</p>

<p>Everyone looked at him.</p>

<p>"We don't purge it. We don't shut down. We trap it."</p>

<p>The Lorekeeper's eyes sharpened. "Explain."</p>

<p>"The entity is learning how we respond to chaos. So we teach it." Shade stepped into the light, Whisper flowing around him like living shadow. "We create a false sector. A decoy portion of the transaction system that looks real but isn't. Let the entity play there while the Cipher Monks rebuild the actual systems behind barriers it can't see."</p>

<p>"A honeypot," Valdris said. "Tactical deception."</p>

<p>"How long would that take to implement?" the Queen asked.</p>

<p>Cassia was already calculating. "To create a convincing false sector? Eight hours minimum. To rebuild the actual systems behind protection? Three days."</p>

<p>"Three days of the entity learning in our decoy," the Lorekeeper said. "Three days for it to potentially discover the deception."</p>

<p>"Or three days of merchants operating in controlled chaos while we fix the problem," Shade countered. "Cassia, can your guild houses function for three days with partially corrupted data?"</p>

<p>Cassia thought of Master Kelvin, of Mistress Threadweaver, of the forty guild leaders who'd just agreed to manual record-keeping. Thought of the thousands of merchants who trusted her to protect their livelihoods.</p>

<p>"They can function for three days with <em>known</em> partially corrupted data," she said carefully. "If we tell them it's temporary, if we give them workarounds, if we promise it's being fixedâ€”yes. They can manage. Barely."</p>

<p>"But?" the Queen prompted.</p>

<p>"But if the entity discovers the deception early, if it lashes out, if <em>anything</em> goes wrongâ€”" Cassia met Lyra's eyes. "We could lose everything. Every transaction record. Every contract. Every proof of ownership in the entire Kingdom."</p>

<p>"What are the odds of success?" Valdris asked.</p>

<p>Shade tilted his head. "Whisper estimates seventy percent."</p>

<p>"You're basing our entire economy on a <em>seventy percent</em> chance?"</p>

<p>"I'm basing it on the fact that both other options guarantee failure," Shade said. "This is the only path that <em>might</em> work."</p>

<p>The Queen looked at each of them in turn. "Lorekeeper?"</p>

<p>"The historical precedent is... mixed. Similar deceptions have worked. They've also failed catastrophically. But Shade is correctâ€”the alternative options lead nowhere good."</p>

<p>"Valdris?"</p>

<p>The High Commander's jaw worked. "I hate it. I hate deception tactics, I hate relying on Shade's mysterious entity-companion, and I hate seventy percent odds. Butâ€”" He exhaled sharply. "Shutting down guarantees failure. At least this gives us a chance."</p>

<p>"Cassia?"</p>

<p>Merchant-Lord Goldthread looked at the ledger crystal still flickering with corrupted data in her hand. Thought of Master Kelvin standing in a warehouse full of saffron that didn't exist according to the system.</p>

<p>Thought of the choice the Queen had made during the Forgetting Protocolâ€”the terrible decision between bad options and worse ones.</p>

<p>"Three days," she said. "I can hold the merchant community together for three days. Barely. But Your Majestyâ€”" She looked directly at Lyra. "If this fails, the economic damage will be my responsibility. I need your support to make decisions that will be unpopular."</p>

<p>"Including decisions I might not like?" the Queen asked.</p>

<p>"Especially those."</p>

<p>A long pause. Then Lyra nodded. "You have my support. Make it work."</p>

<p>Cassia felt the weight settle on her shoulders. Heavier than any negotiation, any trade deal, any crisis she'd managed before.</p>

<p>"Then let's begin."</p>

        </div>
      </article>

      <!-- Real-World Brief Panel -->
      <article id="panelAnalysis" class="story-panel">
        <div class="mx-auto max-w-4xl prose-lore">

<h2>Real-World Brief â€” When You Can't Trust the Data</h2>

<p>In cybersecurity, this kind of incident is called a <strong>data integrity failure</strong>.</p>

<p>Not a breach. Not theft. Not ransomware.</p>

<p>Something more dangerous.</p>

<p>In most attacks, the problem is <em>loss</em>. Files are stolen. Systems go down. Data is encrypted. Those are terrible, but at least they're clear. You know what's broken.</p>

<p>Integrity attacks are different.</p>

<p>Here, the systems still run. Transactions still process. Reports still generate.</p>

<p>But no one knows what's real anymore.</p>

<p>Cassia's crisis mirrors real incidents where attackers didn't destroy systems. They quietly altered records. Changed timestamps. Duplicated transactions. Deleted a few entries. Rewrote others.</p>

<p>The goal is not chaos.</p>

<p><strong>The goal is doubt.</strong></p>

<p>Once merchants stop trusting their own ledgers, the economy collapses on its own.</p>

<h3>When Trust Fails, Commerce Follows</h3>

<p>Modern economies depend on digital records to answer simple questions:</p>

<ul>
  <li>Who owns what</li>
  <li>What was paid</li>
  <li>What was shipped</li>
  <li>What exists</li>
</ul>

<p>When those answers become unreliable, trade stops.</p>

<p>After the <strong>NotPetya attack in 2017</strong>, shipping giant Maersk lost the ability to verify where thousands of containers were located. Ships still sailed. Ports still operated.</p>

<p>But no one trusted the tracking systems.</p>

<p>For weeks, global shipping ran on phone calls, paper manifests, and best guesses.</p>

<p>Banks face the same problem during payment system failures. Manufacturers face it when production records are corrupted.</p>

<p>The damage rarely comes from stolen data.</p>

<p><strong>It comes from not knowing what to believe.</strong></p>

<h3>The First Hard Decision: Slow and Correct vs Fast and Wrong</h3>

<p>Cassia's order to revert to manual ledgers is one of the most realistic moments in this story.</p>

<p>When transaction systems can't be trusted, leaders face three bad choices:</p>

<ol>
  <li>Shut everything down and rebuild</li>
  <li>Keep running and hope the data is right</li>
  <li>Operate manually while fixing systems in parallel</li>
</ol>

<p>Option three is brutal.</p>

<p>It is slower. It is expensive. It makes everyone angry.</p>

<p>But it preserves the one thing commerce cannot survive without.</p>

<p><strong>Trust.</strong></p>

<p>Hospitals do this during ransomware attacks. Banks do this during settlement failures. Shipping companies do this when tracking systems collapse.</p>

<p>Paper returns. Phones return. Human verification returns.</p>

<p>Technology pauses. Business continues.</p>

<p>Barely.</p>

<h3>The Leadership Lesson</h3>

<p>This chapter is not about hacking.</p>

<p>It's about <strong>leadership under uncertainty</strong>.</p>

<p>Cassia does three things that real crisis leaders must do:</p>

<ol>
  <li>She tells the truth early, even when it's ugly</li>
  <li>She sets a temporary plan instead of waiting for perfect answers</li>
  <li>She accepts personal responsibility for the outcome</li>
</ol>

<p>Most major security failures are not technical.</p>

<p>They are leadership failures.</p>

<p>Delayed decisions. Hidden damage. False certainty.</p>

<p>Cassia chooses the hardest path.</p>

<p><strong>Slow. Visible. Accountable.</strong></p>

<p>And that choice is the only reason the Kingdom still has an economy at all.</p>

<p class="mt-8 p-4 bg-abyss/40 border border-rift/50 rounded-lg text-sm text-stardust/70 italic">
  A full technical and leadership analysis of this Chronicle will be released with the complete edition.
</p>

        </div>
      </article>

      <!-- Series Navigation (dynamically populated) -->
      <nav id="seriesNav" class="series-nav hidden" aria-label="Chronicle series navigation">
        <!-- Will be populated by JavaScript based on chronicles.index.json -->
      </nav>

      <!-- Context Footer -->
      <div class="mx-auto max-w-3xl mt-12 soft-card p-6">
        <h3 class="font-display text-xl text-stardust/95">Appearing in this Chronicle</h3>
        <div class="mt-3 flex flex-wrap gap-2 text-sm">
          <a href="/characters/cassia.html" class="rounded-full border border-rift/60 bg-abyss/30 px-3 py-1 text-stardust/85 hover:text-glow">Merchant-Lord Cassia</a>
          <a href="/characters/lyra.html" class="rounded-full border border-rift/60 bg-abyss/30 px-3 py-1 text-stardust/85 hover:text-glow">Queen Lyra</a>
          <a href="/characters/valdris.html" class="rounded-full border border-rift/60 bg-abyss/30 px-3 py-1 text-stardust/85 hover:text-glow">High Commander Valdris</a>
          <a href="/characters/shade.html" class="rounded-full border border-rift/60 bg-abyss/30 px-3 py-1 text-stardust/85 hover:text-glow">Shade</a>
          <a href="/characters/lorekeeper.html" class="rounded-full border border-rift/60 bg-abyss/30 px-3 py-1 text-stardust/85 hover:text-glow">The Lorekeeper</a>
        </div>
      
        <div class="mt-6 h-px w-full bg-rift/60"></div>
      
        <div class="mt-6">
          <a href="/chronicles.html" class="inline-flex items-center gap-3 group text-stardust/80 hover:text-glow transition-colors">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-stardust/60 group-hover:text-glow transition-colors">
              <polyline points="15 18 9 12 15 6"/>
            </svg>
            <span>
              <span class="text-xs uppercase tracking-wider text-stardust/60 block">Back to</span>
              <span class="font-display text-stardust/90 group-hover:text-glow transition-colors">All Chronicles</span>
            </span>
          </a>
        </div>
      </div>
    </section>

<!-- Email capture (Netlify Forms with JavaScript) -->
    <section id="subscribe" class="relative z-10 mt-12 mx-auto max-w-xl scroll-mt-24">  
      <div class="mt-8 mx-auto max-w-xl scroll-mt-24">
        <!-- Success Message (hidden by default) -->
        <div id="subscribe-success" class="hidden mb-4 rounded-md bg-nebula/20 border border-glow/40 px-6 py-4 text-center backdrop-blur transition-opacity duration-500">
          <p class="text-glow font-semibold">ðŸ“œ Inscription Complete</p>
          <p class="mt-1 text-sm text-stardust/85">Your name has been added to the Tower's registry.</p>
        </div>
    
        <!-- Error Message (hidden by default) -->
        <div id="subscribe-error" class="hidden mb-4 rounded-md border border-red-400/60 bg-red-400/10 px-6 py-4 text-center backdrop-blur transition-opacity duration-500">
          <p class="text-red-400 font-semibold">âš  Something went wrong</p>
          <p class="mt-1 text-sm text-stardust/85">Please try again or contact us if the problem persists.</p>
        </div>
    
        <form id="subscribe-form" name="chronicle-subscribe" method="POST" data-netlify="true" netlify-honeypot="bot-field"
          class="grid gap-3 text-left">
          <input type="hidden" name="form-name" value="chronicle-subscribe" />
      
          <!-- Honeypot -->
          <p class="hidden">
            <label>Don't fill this out: <input name="bot-field" /></label>
          </p>
          
          <!-- Name and Email Row -->
          <div class="grid gap-3 sm:grid-cols-2">
            <div>
              <label for="name" class="block text-sm text-stardust/70 mb-1">Name</label>
              <input type="text" id="name" name="name" required
                class="w-full rounded-md border border-rift/60 bg-abyss/50 px-4 py-2 text-stardust placeholder:text-stardust/50 focus:border-glow/60 focus:outline-none focus:ring-1 focus:ring-glow/40"
                placeholder="Your name">
            </div>
            <div>
              <label for="email" class="block text-sm text-stardust/70 mb-1">Email</label>
              <input type="email" id="email" name="email" required
                class="w-full rounded-md border border-rift/60 bg-abyss/50 px-4 py-2 text-stardust placeholder:text-stardust/50 focus:border-glow/60 focus:outline-none focus:ring-1 focus:ring-glow/40"
                placeholder="you@example.com">
            </div>
          </div>
      
          <button type="submit" id="subscribe-button" class="focus-ring inline-flex items-center justify-center rounded-md bg-glow px-5 py-3 font-semibold text-abyss shadow-glow hover:brightness-110 disabled:opacity-50 disabled:cursor-not-allowed">
            Subscribe
          </button>
        </form>
    
        <p class="mt-3 text-center text-xs text-stardust/65">
          No spam. Just dispatches from the Dreaming Tower when new Chronicles are released.
        </p>
      </div>
    </section>
    
    <script>
      (function() {
        // Handle newsletter subscription
        const form = document.getElementById('subscribe-form');
        const successMessage = document.getElementById('subscribe-success');
        const errorMessage = document.getElementById('subscribe-error');
        const submitButton = document.getElementById('subscribe-button');
    
        if (!form) return;
    
        form.addEventListener('submit', async (e) => {
          e.preventDefault();
    
          // Get form data
          const formData = new FormData(form);
    
          // Disable button and show loading state
          submitButton.disabled = true;
          const originalButtonText = submitButton.textContent;
          submitButton.textContent = 'Subscribing...';
    
          // Hide any previous messages
          successMessage.classList.add('hidden');
          errorMessage.classList.add('hidden');
    
          try {
            // Submit to Netlify
            const response = await fetch('/', {
              method: 'POST',
              headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
              body: new URLSearchParams(formData).toString()
            });
    
            if (response.ok) {
              // Show success message with fade-in
              successMessage.classList.remove('hidden');
              successMessage.style.opacity = '0';
              
              // Scroll message into view
              successMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
              
              // Trigger fade-in
              setTimeout(() => {
                successMessage.style.opacity = '1';
              }, 10);
    
              // Reset form
              form.reset();
    
              // Fade out after 5 seconds
              setTimeout(() => {
                successMessage.style.opacity = '0';
                setTimeout(() => {
                  successMessage.classList.add('hidden');
                }, 500);
              }, 5000);
    
            } else {
              throw new Error('Submission failed');
            }
          } catch (error) {
            console.error('Error:', error);
            
            // Show error message
            errorMessage.classList.remove('hidden');
            errorMessage.style.opacity = '0';
            
            // Scroll message into view
            errorMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            
            setTimeout(() => {
              errorMessage.style.opacity = '1';
            }, 10);
    
            // Hide error after 7 seconds
            setTimeout(() => {
              errorMessage.style.opacity = '0';
              setTimeout(() => {
                errorMessage.classList.add('hidden');
              }, 500);
            }, 7000);
          } finally {
            // Reset button
            submitButton.disabled = false;
            submitButton.textContent = originalButtonText;
          }
        });
      })();
    </script>

  <!-- Return to Top Button -->
  <button 
    id="returnToTop" 
    class="fixed bottom-6 right-6 z-50 hidden focus-ring rounded-full bg-abyss/90 border border-rift/60 p-3 shadow-glow hover:border-glow/60 hover:bg-abyss transition-all group"
    aria-label="Return to top"
    title="Return to top">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-stardust/80 group-hover:text-glow transition-colors">
      <polyline points="18 15 12 9 6 15"/>
    </svg>
  </button>

  <div id="site-footer"></div>

  <script>
  // ---------- Page Configuration ----------
  const CURRENT_CHRONICLE = {
    seriesId: "price-of-certainty",  // Base ID for the series
    part: 1,                          // Current part number
    totalParts: 3                     // Total parts in series
  };

  // ---------- Utilities ----------
  async function loadPartial(targetId, url) {
    const el = document.getElementById(targetId);
    if (!el) return;

    const res = await fetch(url, { cache: "no-cache" });
    if (!res.ok) {
      console.warn(`Failed to load partial: ${url} (${res.status})`);
      return;
    }
    el.innerHTML = await res.text();
  }

  function initHeaderNav() {
    const navToggle = document.getElementById("navToggle");
    const mobileNavPanel = document.getElementById("mobileNavPanel");

    if (!navToggle || !mobileNavPanel) return;

    navToggle.addEventListener("click", () => {
      const isOpen = navToggle.getAttribute("aria-expanded") === "true";
      navToggle.setAttribute("aria-expanded", String(!isOpen));
      mobileNavPanel.classList.toggle("hidden", isOpen);
    });

    document.addEventListener("keydown", (e) => {
      if (e.key !== "Escape") return;
      if (navToggle.getAttribute("aria-expanded") === "true") {
        navToggle.setAttribute("aria-expanded", "false");
        mobileNavPanel.classList.add("hidden");
      }
    });
  }

  function initFooterYear() {
    const year = document.getElementById("year");
    if (year) year.textContent = new Date().getFullYear();
  }

  // ---------- Story/Analysis Toggle ----------
  function initStoryAnalysisToggle() {
    const btnStory = document.getElementById("btnStory");
    const btnAnalysis = document.getElementById("btnAnalysis");
    const panelStory = document.getElementById("panelStory");
    const panelAnalysis = document.getElementById("panelAnalysis");

    if (!btnStory || !btnAnalysis || !panelStory || !panelAnalysis) return;

    function showPanel(which) {
      const isAnalysis = which === "analysis";
      const toShow = isAnalysis ? panelAnalysis : panelStory;
      const toHide = isAnalysis ? panelStory : panelAnalysis;

      const y = window.scrollY;

      btnStory.setAttribute("aria-pressed", String(!isAnalysis));
      btnAnalysis.setAttribute("aria-pressed", String(isAnalysis));

      // Update button text with icons
      btnStory.innerHTML = `<span class="toggle-icon" aria-hidden="true">${!isAnalysis ? "â—‰" : "â—¯"}</span> <span>Chronicle</span>`;
      btnAnalysis.innerHTML = `<span class="toggle-icon" aria-hidden="true">${isAnalysis ? "â—‰" : "â—¯"}</span> <span>Real-World Brief</span>`;

      toHide.classList.remove("is-active");
      toShow.classList.add("is-active");

      toShow.classList.remove("fade-enter", "fade-enter-active");
      toShow.classList.add("fade-enter");
      requestAnimationFrame(() => toShow.classList.add("fade-enter-active"));

      // Update hash for shareable links
      if (isAnalysis) {
        history.replaceState(null, "", "#brief");
      } else {
        history.replaceState(null, "", window.location.pathname);
      }

      window.scrollTo(0, y);
    }

    btnStory.addEventListener("click", () => showPanel("story"));
    btnAnalysis.addEventListener("click", () => showPanel("analysis"));

    // Initialize based on URL
    if (window.location.hash === "#brief") showPanel("analysis");
    else showPanel("story");
  }

  // ---------- Series Navigation ----------
  async function initSeriesNav() {
    const seriesNav = document.getElementById("seriesNav");
    if (!seriesNav) return;

    try {
      // Fetch the chronicles index
      const response = await fetch("/data/chronicles.index.json");
      if (!response.ok) {
        console.warn("Could not load chronicles index");
        return;
      }

      const chronicles = await response.json();
      
      // Find all parts of this series that are released
      const seriesParts = chronicles.filter(c => 
        c.seriesId === CURRENT_CHRONICLE.seriesId && 
        c.released === true
      ).sort((a, b) => a.part - b.part);

      // If only one part exists, don't show navigation
      if (seriesParts.length <= 1) {
        seriesNav.classList.add("hidden");
        return;
      }

      // Find previous and next parts
      const currentPart = CURRENT_CHRONICLE.part;
      const prevPart = seriesParts.find(p => p.part === currentPart - 1);
      const nextPart = seriesParts.find(p => p.part === currentPart + 1);

      // Build navigation HTML
      let navHTML = "";

      // Previous link
      if (prevPart) {
        navHTML += `
          <a href="${prevPart.href}" class="flex items-center gap-2">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"/>
            </svg>
            Part ${prevPart.part}: ${prevPart.partTitle || 'Previous'}
          </a>
        `;
      } else {
        navHTML += `<span></span>`; // Empty spacer
      }

      // Center indicator
      navHTML += `<span class="text-stardust/60 text-sm">Part ${currentPart} of ${CURRENT_CHRONICLE.totalParts}</span>`;

      // Next link
      if (nextPart) {
        navHTML += `
          <a href="${nextPart.href}" class="flex items-center gap-2">
            Part ${nextPart.part}: ${nextPart.partTitle || 'Next'}
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"/>
            </svg>
          </a>
        `;
      } else {
        navHTML += `<span></span>`; // Empty spacer
      }

      seriesNav.innerHTML = navHTML;
      seriesNav.classList.remove("hidden");

    } catch (error) {
      console.warn("Error loading series navigation:", error);
      seriesNav.classList.add("hidden");
    }
  }

  // ---------- Return to Top ----------
  function initReturnToTop() {
    const returnToTopBtn = document.getElementById('returnToTop');
    
    if (!returnToTopBtn) return;

    window.addEventListener('scroll', () => {
      if (window.scrollY > 400) {
        returnToTopBtn.classList.remove('hidden');
      } else {
        returnToTopBtn.classList.add('hidden');
      }
    }, { passive: true });

    returnToTopBtn.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  }

  // ---------- Boot ----------
  (async function boot() {
    await loadPartial("site-header", "/partials/header.html");
    initHeaderNav();

    await loadPartial("site-footer", "/partials/footer.html");
    initFooterYear();

    initStoryAnalysisToggle();
    initSeriesNav();
    initReturnToTop();
  })();
</script>
</main>
</body>
</html>
